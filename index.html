<style>
  #summary-text {
    font-size: 20px;
    font-family: monospace;
    white-space: pre-wrap;
  }
</style>
<body>
  <h1>Polish presidential election projection</h1>
  <h1>Currently values reflect test data! Ignore it for now. Check back at 21:00 CEST for the first projections.</h1>

  <p>This projection updates every 60 seconds, based on the results published by <a href="https://wybory.gov.pl/prezydent2025/en/dane_w_arkuszach" target="_blank">PKW</a>. The actual rate of updates depend on how frequently and how fast results are reported.</p>
  <p>Projection is based on the results in precincts which have already reported, while the remaining precinct results are projected based on the trends observed in those that have reported.</p>

  
  <pre id="summary-text">Loading summary...</pre>

  <p id="last-updated">Last updated: loadingâ€¦</p>
  
  <p>Download the raw csv <a href="https://politiskeprognoser.github.io/projections/projected.csv" target="_blank">here</a> (includes precinct-level projections).</p>
  <p>Contact me on <a href="https://bsky.app/profile/gust2319.bsky.social" target="_blank">Bluesky</a> or <a href="https://x.com/Gust_2319" target="_blank">X</a>.</p>

  <input type="text" id="filter" placeholder="Filter rows (e.g. Warszawa, Mazowieckie)..." onkeyup="filterTable()">
  <table border="1" id="csv-table"></table>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
  <script>
    fetch('summary.txt?' + new Date().getTime())
      .then(response => response.text())
      .then(text => {
        document.getElementById('summary-text').textContent = text;
      });

    fetch('projected.csv')
      .then(response => response.text())
      .then(text => {
        const data = Papa.parse(text, { header: true });
        const table = document.getElementById('csv-table');

        const headerRow = document.createElement('tr');
        data.meta.fields.forEach(field => {
          const th = document.createElement('th');
          th.textContent = field;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        data.data.slice(0, 3439).forEach(row => {
          const tr = document.createElement('tr');
          data.meta.fields.forEach(field => {
            const td = document.createElement('td');
            td.textContent = row[field];
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
        document.getElementById('last-updated').textContent =
        "Last updated: " + new Date().toLocaleString("pl-PL");
      });
    function filterTable() {
  const input = document.getElementById("filter").value.toLowerCase();
  const rows = document.querySelectorAll("#csv-table tr");
  rows.forEach((row, index) => {
    if (index === 0) return; // Keep header always
    row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none";
  });
}
  </script>
</body>
