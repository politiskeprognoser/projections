<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Polish Presidential Election Projection</title>
<style>
  #summary-text {
    font-size: 20px;
    font-family: monospace;
    white-space: pre-wrap;
  }
</style>
</head>
<body>
  <h1>Polish presidential election projection</h1>
  <h1>Currently values reflect test data! Ignore it for now. Check back at 21:00 CEST for the first projections.</h1>

  <p>This projection updates every 60 seconds, based on the results published by <a href="https://wybory.gov.pl/prezydent2025/en/dane_w_arkuszach" target="_blank">PKW</a>. The actual rate of updates depend on how frequently and how fast results are reported.</p>
  <p>Projection is based on the results in precincts which have already reported, while the remaining precinct results are projected based on the trends observed in those that have reported.</p>

  
  <div id="results-summary"></div>

  <p id="last-updated">Last updated: loadingâ€¦</p>
  
  <p>Download the raw csv <a href="https://politiskeprognoser.github.io/projections/projected.csv" target="_blank">here</a> (includes precinct-level projections).</p>
  <p>Contact me on <a href="https://bsky.app/profile/gust2319.bsky.social" target="_blank">Bluesky</a> or <a href="https://x.com/Gust_2319" target="_blank">X</a>.</p>

  <table border="1" id="csv-table"></table>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.1/papaparse.min.js"></script>
  <script>
    fetch('projected.csv')
      .then(response => response.text())
      .then(text => {
        const data = Papa.parse(text, { header: true });
        const table = document.getElementById('csv-table');

        const headerRow = document.createElement('tr');
        data.meta.fields.forEach(field => {
          const th = document.createElement('th');
          th.textContent = field;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        data.data.slice(0, 3439).forEach(row => {
          const tr = document.createElement('tr');
          data.meta.fields.forEach(field => {
            const td = document.createElement('td');
            td.textContent = row[field];
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
        document.getElementById('last-updated').textContent =
        "Last updated: " + new Date().toLocaleString("pl-PL");
      });
fetch("summary.json")
  .then(response => response.json())
  .then(data => {
    const container = document.getElementById("results-summary");

    const counted = document.createElement("p");
    counted.innerHTML = `<strong>Counted:</strong> ${data.counted_pct.toFixed(2)}%`;
    container.appendChild(counted);

    const table = document.createElement("table");
    table.style.borderCollapse = "collapse";
    table.style.marginBottom = "1em";

    const header = document.createElement("tr");
    ["Candidate", "Current Votes", "Current %", "Projected Votes", "Projected %"].forEach(text => {
      const th = document.createElement("th");
      th.textContent = text;
      th.style.borderBottom = "2px solid black";
      th.style.padding = "4px 8px";
      header.appendChild(th);
    });
    table.appendChild(header);

    data.parties.forEach(p => {
      const row = document.createElement("tr");

      const currVotes = p.current_votes.toLocaleString("pl-PL");
      const projVotes = p.projected_votes.toLocaleString("pl-PL");

      [p.name, currVotes, `${p.current_pct.toFixed(1)}%`, projVotes, `${p.projected_pct.toFixed(1)}%`].forEach(val => {
        const td = document.createElement("td");
        td.textContent = val;
        td.style.padding = "4px 8px";
        row.appendChild(td);
      });

      table.appendChild(row);
    });

    container.appendChild(table);

    const reportingHeader = document.createElement("p");
    reportingHeader.textContent = "Places that have reported:";
    container.appendChild(reportingHeader);

    for (const [level, stats] of Object.entries(data.divisions)) {
      const p = document.createElement("p");
      const pct = (stats.reported_divisions / stats.total_divisions * 100).toFixed(1);
      p.textContent = `${level}: ${stats.reported_divisions} out of ${stats.total_divisions} divisions (${pct}%) have at least one reported precinct`;
      container.appendChild(p);
    }

    const precinctPct = (data.precincts_reported / data.total_precincts * 100).toFixed(1);
    const precinctP = document.createElement("p");
    precinctP.innerHTML = `<strong>Precincts:</strong> ${data.precincts_reported.toLocaleString("pl-PL")} out of ${data.total_precincts.toLocaleString("pl-PL")} (${precinctPct}%) have reported`;
    container.appendChild(precinctP);
  });
  </script>
</body>
